{"version":3,"sources":["../passwordless.js"],"names":["window","Joomla","akeeba","Passwordless","document","interpolateParameters","object","prefix","encodedString","Object","keys","forEach","prop","length","encodeURIComponent","findField","form","fieldSelector","elInputs","querySelectorAll","lookForField","innerElement","elElement","parentElement","elInput","nodeName","elForms","i","reportErrorToUser","message","renderMessages","error","handleLoginChallenge","publicKey","callbackUrl","arrayToBase64String","a","btoa","String","fromCharCode","base64url2base64","input","output","replace","pad","Error","Array","join","challenge","JText","_","Uint8Array","from","atob","c","charCodeAt","allowCredentials","map","data","id","navigator","credentials","get","then","publicKeyCredential","type","rawId","response","authenticatorData","clientDataJSON","signature","userHandle","location","JSON","stringify","createCredentials","storeID","interfaceSelector","elStore","getElementById","parse","dataset","public_key","postURL","postback_url","user","excludeCredentials","create","attestationObject","postBackData","option","group","plugin","format","akaction","encoding","request","url","method","onSuccess","responseHTML","elements","elContainer","outerHTML","initManagement","onError","xhr","status","statusText","editLabel","that","elTR","credentialId","credential_id","elTDs","elLabelTD","elButtonsTD","elButtons","elEdit","elDelete","oldLabel","innerText","createElement","name","defaultValue","elSave","className","addEventListener","elNewLabel","value","new_label","rawResponse","result","exception","disabled","elCancel","innerHTML","appendChild","e","removeChild","addOnClick","event","preventDefault","currentTarget","getAttribute","editOnClick","deleteOnClick","moveButton","elPasswordlessLoginButton","possibleSelectors","undefined","elLoginBtn","selector","login","elUsername","elReturn","username","returnUrl","jsonData","addButton","editLabelButtons","slice","call","button","deleteButtons","initLogin","loginButtons"],"mappings":"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","sourcesContent":["/*\n * @package   AkeebaPasswordlessLogin\n * @copyright Copyright (c)2018-2020 Nicholas K. Dionysopoulos / Akeeba Ltd\n * @license   GNU General Public License version 3, or later\n */\n\nwindow.Joomla              = window.Joomla || {};\nwindow.akeeba              = window.akeeba || {};\nwindow.akeeba.Passwordless = window.akeeba.Passwordless || {};\n\n/**\n * Akeeba Passwordless Login client-side implementation\n *\n * This is the EcmaScript 6+ source of the client-side implementation. It is meant to be transpiled to ES5.1 (plain old\n * JavaScript) with Babel. The actual file being loaded can be found in dist/passwordless.js.\n */\n((Joomla, Passwordless, document) =>\n{\n    \"use strict\";\n\n    /**\n     * Converts a simple object containing query string parameters to a single, escaped query string.\n     * This method is a necessary evil since Joomla.request can only accept data as a string.\n     *\n     * @param    object   {object}  A plain object containing the query parameters to pass\n     * @param    prefix   {string}  Prefix for array-type parameters\n     *\n     * @returns  {string}\n     */\n    const interpolateParameters = (object, prefix = \"\") =>\n    {\n        let encodedString = \"\";\n\n        Object.keys(object).forEach((prop) =>\n        {\n            if (typeof object[prop] !== \"object\")\n            {\n                if (encodedString.length > 0)\n                {\n                    encodedString += \"&\";\n                }\n\n                if (prefix === \"\")\n                {\n                    encodedString += `${encodeURIComponent(prop)}=${encodeURIComponent(object[prop])}`;\n                }\n                else\n                {\n                    encodedString\n                        += `${encodeURIComponent(prefix)}[${encodeURIComponent(prop)}]=${encodeURIComponent(\n                        object[prop],\n                    )}`;\n                }\n\n                return;\n            }\n\n            // Objects need special handling\n            encodedString += `${interpolateParameters(object[prop], prop)}`;\n        });\n\n        return encodedString;\n    };\n\n    /**\n     * Finds the first field matching a selector inside a form\n     *\n     * @param   {HTMLFormElement}  form           The FORM element\n     * @param   {String}           fieldSelector  The CSS selector to locate the field\n     *\n     * @returns {Element|null}  NULL when no element is found\n     */\n    const findField = (form, fieldSelector) =>\n    {\n        const elInputs = form.querySelectorAll(fieldSelector);\n\n        if (!elInputs.length)\n        {\n            return null;\n        }\n\n        return elInputs[0];\n    };\n\n    /**\n     * Find a form field described by the CSS selector fieldSelector.\n     * The field must be inside a <form> element which is either the\n     * innerElement itself or enclosed by innerElement.\n     *\n     * @param   {Element}  innerElement   The element which is either our form or contains our form.\n     * @param   {String}   fieldSelector  The CSS selector to locate the field\n     *\n     * @returns {null|Element}  NULL when no element is found\n     */\n    const lookForField = (innerElement, fieldSelector) =>\n    {\n        let elElement = innerElement.parentElement;\n        let elInput   = null;\n\n        while (true)\n        {\n            if (!elElement)\n            {\n                return null;\n            }\n\n            if (elElement.nodeName === \"FORM\")\n            {\n                elInput = lookForField(elElement, fieldSelector);\n\n                if (elInput !== null)\n                {\n                    return elInput;\n                }\n\n                break;\n            }\n\n            const elForms = elElement.querySelectorAll(\"form\");\n\n            if (elForms.length)\n            {\n                for (let i = 0; i < elForms.length; i++)\n                {\n                    elInput = findField(elForms[i], fieldSelector);\n\n                    if (elInput !== null)\n                    {\n                        return elInput;\n                    }\n                }\n\n                break;\n            }\n\n            elElement = elElement.parentElement;\n        }\n\n        return null;\n    };\n\n    /**\n     * A simple error handler.\n     *\n     * @param   {String}  message\n     */\n    const reportErrorToUser = (message) =>\n    {\n        Joomla.renderMessages({error: [message]});\n    };\n\n    /**\n     * Handles the browser response for the user interaction with the authenticator. Redirects to an\n     * internal page which handles the login server-side.\n     *\n     * @param {  Object}  publicKey     Public key request options, returned from the server\n     * @param   {String}  callbackUrl  The URL we will use to post back to the server. Must include\n     *   the anti-CSRF token.\n     */\n    const handleLoginChallenge = (publicKey, callbackUrl) =>\n    {\n        const arrayToBase64String = (a) => btoa(String.fromCharCode(...a));\n\n        const base64url2base64 = (input) =>\n        {\n            let output = input\n                .replace(/-/g, \"+\")\n                .replace(/_/g, \"/\");\n            const pad  = output.length % 4;\n            if (pad)\n            {\n                if (pad === 1)\n                {\n                    throw new Error(\n                        \"InvalidLengthError: Input base64url string is the wrong length to determine padding\");\n                }\n                output += new Array(5 - pad).join(\"=\");\n            }\n            return output;\n        };\n\n        if (!publicKey.challenge)\n        {\n            reportErrorToUser(Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_INVALID_USERNAME\"));\n\n            return;\n        }\n\n        publicKey.challenge = Uint8Array.from(\n            window.atob(base64url2base64(publicKey.challenge)), (c) => c.charCodeAt(0),\n        );\n\n        if (publicKey.allowCredentials)\n        {\n            publicKey.allowCredentials = publicKey.allowCredentials.map((data) =>\n            {\n                data.id = Uint8Array.from(window.atob(base64url2base64(data.id)), (c) => c.charCodeAt(0));\n                return data;\n            });\n        }\n\n        navigator.credentials.get({publicKey})\n                 .then((data) =>\n                 {\n                     const publicKeyCredential = {\n                         id:       data.id,\n                         type:     data.type,\n                         rawId:    arrayToBase64String(new Uint8Array(data.rawId)),\n                         response: {\n                             authenticatorData: arrayToBase64String(new Uint8Array(data.response.authenticatorData)),\n                             clientDataJSON:    arrayToBase64String(new Uint8Array(data.response.clientDataJSON)),\n                             signature:         arrayToBase64String(new Uint8Array(data.response.signature)),\n                             userHandle:        data.response.userHandle ? arrayToBase64String(\n                                 new Uint8Array(data.response.userHandle),\n                             ) : null,\n                         },\n                     };\n\n                     // Send the response to your server\n                     window.location = `${callbackUrl}&option=com_ajax&group=system&plugin=passwordless&`\n                         + `format=raw&akaction=login&encoding=redirect&data=${\n                             btoa(JSON.stringify(publicKeyCredential))}`;\n                 })\n                 .catch((error) =>\n                 {\n                     // Example: timeout, interaction refused...\n                     reportErrorToUser(error);\n                 });\n    };\n\n    /**\n     * Ask the user to link an authenticator using the provided public key (created server-side).\n     * Posts the credentials to the URL defined in post_url using AJAX.\n     * That URL must re-render the management interface.\n     * These contents will replace the element identified by the interface_selector CSS selector.\n     *\n     * @param   {String}  storeID            CSS ID for the element storing the configuration in its\n     *                                        data properties\n     * @param   {String}  interfaceSelector  CSS selector for the GUI container\n     */\n    // eslint-disable-next-line no-unused-vars\n    Passwordless.createCredentials = (storeID, interfaceSelector) =>\n    {\n        // Make sure the browser supports Webauthn\n        if (!(\"credentials\" in navigator))\n        {\n            Joomla.renderMessages({error: [Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_NO_BROWSER_SUPPORT\")]});\n\n            return;\n        }\n\n        // Extract the configuration from the store\n        const elStore = document.getElementById(storeID);\n\n        if (!elStore)\n        {\n            return;\n        }\n\n        const publicKey = JSON.parse(atob(elStore.dataset.public_key));\n        const postURL   = atob(elStore.dataset.postback_url);\n\n        const arrayToBase64String = (a) => btoa(String.fromCharCode(...a));\n\n        const base64url2base64 = (input) =>\n        {\n            let output = input\n                .replace(/-/g, \"+\")\n                .replace(/_/g, \"/\");\n            const pad  = output.length % 4;\n            if (pad)\n            {\n                if (pad === 1)\n                {\n                    throw new Error(\n                        \"InvalidLengthError: Input base64url string is the wrong length to determine padding\");\n                }\n                output += new Array(5 - pad).join(\"=\");\n            }\n            return output;\n        };\n\n        // Convert the public key information to a format usable by the browser's credentials manager\n        publicKey.challenge = Uint8Array.from(\n            window.atob(base64url2base64(publicKey.challenge)), (c) => c.charCodeAt(0),\n        );\n\n        publicKey.user.id = Uint8Array.from(window.atob(publicKey.user.id), (c) => c.charCodeAt(0));\n\n        if (publicKey.excludeCredentials)\n        {\n            publicKey.excludeCredentials = publicKey.excludeCredentials.map((data) =>\n            {\n                data.id = Uint8Array.from(window.atob(base64url2base64(data.id)), (c) => c.charCodeAt(0));\n                return data;\n            });\n        }\n\n        // Ask the browser to prompt the user for their authenticator\n        navigator.credentials.create({publicKey})\n                 .then((data) =>\n                 {\n                     const publicKeyCredential = {\n                         id:       data.id,\n                         type:     data.type,\n                         rawId:    arrayToBase64String(new Uint8Array(data.rawId)),\n                         response: {\n                             clientDataJSON:    arrayToBase64String(new Uint8Array(data.response.clientDataJSON)),\n                             attestationObject: arrayToBase64String(new Uint8Array(data.response.attestationObject)),\n                         },\n                     };\n\n                     // Send the response to your server\n                     const postBackData = {\n                         option:   \"com_ajax\",\n                         group:    \"system\",\n                         plugin:   \"passwordless\",\n                         format:   \"raw\",\n                         akaction: \"create\",\n                         encoding: \"raw\",\n                         data:     btoa(JSON.stringify(publicKeyCredential)),\n                     };\n\n                     Joomla.request({\n                         url:     postURL,\n                         method:  \"POST\",\n                         data:    interpolateParameters(postBackData),\n                         onSuccess(responseHTML)\n                         {\n                             const elements = document.querySelectorAll(interfaceSelector);\n\n                             if (!elements)\n                             {\n                                 return;\n                             }\n\n                             const elContainer = elements[0];\n\n                             elContainer.outerHTML = responseHTML;\n\n                             Passwordless.initManagement();\n                         },\n                         onError: (xhr) =>\n                                  {\n                                      reportErrorToUser(`${xhr.status} ${xhr.statusText}`);\n                                  },\n                     });\n                 })\n                 .catch((error) =>\n                 {\n                     // An error occurred: timeout, request to provide the authenticator refused, hardware /\n                     // software error...\n                     reportErrorToUser(error);\n                 });\n    };\n\n    /**\n     * Edit label button\n     *\n     * @param   {Element} that      The button being clicked\n     * @param   {String}  storeID  CSS ID for the element storing the configuration in its data\n     *                              properties\n     */\n    // eslint-disable-next-line no-unused-vars\n    Passwordless.editLabel = (that, storeID) =>\n    {\n        // Extract the configuration from the store\n        const elStore = document.getElementById(storeID);\n\n        if (!elStore)\n        {\n            return false;\n        }\n\n        const postURL = atob(elStore.dataset.postback_url);\n\n        // Find the UI elements\n        const elTR         = that.parentElement.parentElement;\n        const credentialId = elTR.dataset.credential_id;\n        const elTDs        = elTR.querySelectorAll(\"td\");\n        const elLabelTD    = elTDs[0];\n        const elButtonsTD  = elTDs[1];\n        const elButtons    = elButtonsTD.querySelectorAll(\"button\");\n        const elEdit       = elButtons[0];\n        const elDelete     = elButtons[1];\n\n        // Show the editor\n        const oldLabel = elLabelTD.innerText;\n\n        const elInput        = document.createElement(\"input\");\n        elInput.type         = \"text\";\n        elInput.name         = \"label\";\n        elInput.defaultValue = oldLabel;\n\n        const elSave     = document.createElement(\"button\");\n        elSave.className = \"btn btn-success btn-sm\";\n        elSave.innerText = Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_SAVE_LABEL\");\n        elSave.addEventListener(\"click\", () =>\n        {\n            const elNewLabel = elInput.value;\n\n            if (elNewLabel !== \"\")\n            {\n                const postBackData = {\n                    option:        \"com_ajax\",\n                    group:         \"system\",\n                    plugin:        \"passwordless\",\n                    format:        \"json\",\n                    encoding:      \"json\",\n                    akaction:      \"savelabel\",\n                    credential_id: credentialId,\n                    new_label:     elNewLabel,\n                };\n\n                Joomla.request({\n                    url:     postURL,\n                    method:  \"POST\",\n                    data:    interpolateParameters(postBackData),\n                    onSuccess(rawResponse)\n                    {\n                        let result = false;\n\n                        try\n                        {\n                            result = JSON.parse(rawResponse);\n                        }\n                        catch (exception)\n                        {\n                            result = (rawResponse === \"true\");\n                        }\n\n                        if (result !== true)\n                        {\n                            reportErrorToUser(\n                                Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED\"),\n                            );\n                        }\n                    },\n                    onError: (xhr) =>\n                             {\n                                 reportErrorToUser(\n                                     `${Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_LABEL_NOT_SAVED\")\n                                     } -- ${xhr.status} ${xhr.statusText}`,\n                                 );\n                             },\n                });\n            }\n\n            elLabelTD.innerText = elNewLabel;\n            elEdit.disabled     = false;\n            elDelete.disabled   = false;\n\n            return false;\n        }, false);\n\n        const elCancel     = document.createElement(\"button\");\n        elCancel.className = \"btn btn-danger btn-sm\";\n        elCancel.innerText = Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_MANAGE_BTN_CANCEL_LABEL\");\n        elCancel.addEventListener(\"click\", () =>\n        {\n            elLabelTD.innerText = oldLabel;\n            elEdit.disabled     = false;\n            elDelete.disabled   = false;\n\n            return false;\n        }, false);\n\n        elLabelTD.innerHTML = \"\";\n        elLabelTD.appendChild(elInput);\n        elLabelTD.appendChild(elSave);\n        elLabelTD.appendChild(elCancel);\n        elEdit.disabled   = true;\n        elDelete.disabled = true;\n\n        return false;\n    };\n\n    /**\n     * Delete button\n     *\n     * @param   {Element} that      The button being clicked\n     * @param   {String}  storeID  CSS ID for the element storing the configuration in its data\n     *                              properties\n     */\n    // eslint-disable-next-line no-unused-vars\n    Passwordless.delete = (that, storeID) =>\n    {\n        // Extract the configuration from the store\n        const elStore = document.getElementById(storeID);\n\n        if (!elStore)\n        {\n            return false;\n        }\n\n        const postURL = atob(elStore.dataset.postback_url);\n\n        // Find the UI elements\n        const elTR         = that.parentElement.parentElement;\n        const credentialId = elTR.dataset.credential_id;\n        const elTDs        = elTR.querySelectorAll(\"td\");\n        const elButtonsTD  = elTDs[1];\n        const elButtons    = elButtonsTD.querySelectorAll(\"button\");\n        const elEdit       = elButtons[0];\n        const elDelete     = elButtons[1];\n\n        elEdit.disabled   = true;\n        elDelete.disabled = true;\n\n        // Delete the record\n        const postBackData = {\n            option:        \"com_ajax\",\n            group:         \"system\",\n            plugin:        \"passwordless\",\n            format:        \"json\",\n            encoding:      \"json\",\n            akaction:      \"delete\",\n            credential_id: credentialId,\n        };\n\n        Joomla.request({\n            url:     postURL,\n            method:  \"POST\",\n            data:    interpolateParameters(postBackData),\n            onSuccess(rawResponse)\n            {\n                let result = false;\n\n                try\n                {\n                    result = JSON.parse(rawResponse);\n                }\n                catch (e)\n                {\n                    result = (rawResponse === \"true\");\n                }\n\n                if (result !== true)\n                {\n                    reportErrorToUser(\n                        Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED\"),\n                    );\n\n                    return;\n                }\n\n                elTR.parentElement.removeChild(elTR);\n            },\n            onError: (xhr) =>\n                     {\n                         elEdit.disabled   = false;\n                         elDelete.disabled = false;\n                         reportErrorToUser(\n                             `${Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_NOT_DELETED\")\n                             } -- ${xhr.status} ${xhr.statusText}`,\n                         );\n                     },\n        });\n\n        return false;\n    };\n\n    /**\n     * Add New Authenticator button click handler\n     *\n     * @param   {MouseEvent} event  The mouse click event\n     *\n     * @returns {boolean} Returns false to prevent the default browser button behavior\n     */\n    Passwordless.addOnClick = (event) =>\n    {\n        event.preventDefault();\n\n        Passwordless.createCredentials(\n            event.currentTarget.getAttribute(\"data-random-id\"), \"#plg_system_passwordless-management-interface\");\n\n        return false;\n    };\n\n    /**\n     * Edit Name button click handler\n     *\n     * @param   {MouseEvent} event  The mouse click event\n     *\n     * @returns {boolean} Returns false to prevent the default browser button behavior\n     */\n    Passwordless.editOnClick = (event) =>\n    {\n        event.preventDefault();\n\n        Passwordless.editLabel(\n            event.currentTarget, event.currentTarget.getAttribute(\"data-random-id\"));\n\n        return false;\n    };\n\n    /**\n     * Remove button click handler\n     *\n     * @param   {MouseEvent} event  The mouse click event\n     *\n     * @returns {boolean} Returns false to prevent the default browser button behavior\n     */\n    Passwordless.deleteOnClick = (event) =>\n    {\n        event.preventDefault();\n\n        Passwordless.delete(event.currentTarget, event.currentTarget.getAttribute(\"data-random-id\"));\n\n        return false;\n    };\n\n    /**\n     * Moves the passwordless login button next to the existing Login button in the login module, if possible. This is\n     * not a guaranteed success! We will *try* to find a button that looks like the login action button. If the\n     * developer of the module or the site integrator doing template overrides didn't bother including some useful\n     * information to help us identify it we're probably going to fail hard.\n     *\n     * @param   {Element}  elPasswordlessLoginButton  The login button to move.\n     * @param   {Array}    possibleSelectors          The CSS selectors to use for moving the button.\n     */\n    Passwordless.moveButton = (elPasswordlessLoginButton, possibleSelectors) =>\n    {\n        if ((elPasswordlessLoginButton === null) || (elPasswordlessLoginButton === undefined))\n        {\n            return;\n        }\n\n        var elLoginBtn = null;\n\n        for (var i = 0; i < possibleSelectors.length; i++)\n        {\n            var selector = possibleSelectors[i];\n\n            elLoginBtn = lookForField(elPasswordlessLoginButton, selector);\n\n            if (elLoginBtn !== null)\n            {\n                break;\n            }\n        }\n\n        if (elLoginBtn === null)\n        {\n            return;\n        }\n\n        elLoginBtn.parentElement.appendChild(elPasswordlessLoginButton);\n    }\n\n    /**\n     * Initialize the passwordless login, going through the server to get the registered certificates\n     * for the user.\n     *\n     * @param   {Element}  that         The login button which was clicked\n     * @param   {string}   callbackUrl  The URL we will use to post back to the server. Must include\n     *   the anti-CSRF token.\n     *\n     * @returns {boolean}  Always FALSE to prevent BUTTON elements from reloading the page.\n     */\n    // eslint-disable-next-line no-unused-vars\n    Passwordless.login = (that, callbackUrl) =>\n    {\n        // Get the username\n        const elUsername = lookForField(that, \"input[name=username]\");\n        const elReturn   = lookForField(that, \"input[name=return]\");\n\n        if (elUsername === null)\n        {\n            Joomla.renderMessages({error: [Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_CANNOT_FIND_USERNAME\")]});\n\n            return false;\n        }\n\n        const username  = elUsername.value;\n        const returnUrl = elReturn ? elReturn.value : null;\n\n        // No username? We cannot proceed. We need a username to find the acceptable public keys :(\n        if (username === \"\")\n        {\n            Joomla.renderMessages({error: [Joomla.JText._(\"PLG_SYSTEM_PASSWORDLESS_ERR_EMPTY_USERNAME\")]});\n\n            return false;\n        }\n\n        // Get the Public Key Credential Request Options (challenge and acceptable public keys)\n        const postBackData = {\n            option:      \"com_ajax\",\n            group:       \"system\",\n            plugin:      \"passwordless\",\n            format:      \"raw\",\n            akaction:    \"challenge\",\n            encoding:    \"raw\",\n            \"username\":  username,\n            \"returnUrl\": returnUrl\n        };\n\n        Joomla.request({\n            url:     callbackUrl,\n            method:  \"POST\",\n            data:    interpolateParameters(postBackData),\n            onSuccess(rawResponse)\n            {\n                let jsonData = {};\n\n                try\n                {\n                    jsonData = JSON.parse(rawResponse);\n                }\n                catch (e)\n                {\n                    /**\n                     * In case of JSON decoding failure fall through; the error will be handled in the login\n                     * challenge handler called below.\n                     */\n                }\n\n                handleLoginChallenge(jsonData, callbackUrl);\n            },\n            onError: (xhr) =>\n                     {\n                         reportErrorToUser(`${xhr.status} ${xhr.statusText}`);\n                     },\n        });\n\n        return false;\n    };\n\n    /**\n     * Initialization on page load.\n     */\n    Passwordless.initManagement = () =>\n    {\n        const addButton = document.getElementById(\"plg_system_passwordless-manage-add\");\n\n        if (addButton)\n        {\n            addButton.addEventListener(\"click\", Passwordless.addOnClick);\n        }\n\n        const editLabelButtons = [].slice.call(document.querySelectorAll(\".plg_system_passwordless-manage-edit\"));\n        if (editLabelButtons.length)\n        {\n            editLabelButtons.forEach((button) =>\n            {\n                button.addEventListener(\"click\", Passwordless.editOnClick);\n            });\n        }\n\n        const deleteButtons = [].slice.call(document.querySelectorAll(\".plg_system_passwordless-manage-delete\"));\n        if (deleteButtons.length)\n        {\n            deleteButtons.forEach((button) =>\n            {\n                button.addEventListener(\"click\", Passwordless.deleteOnClick);\n            });\n        }\n    };\n\n    Passwordless.initLogin = () =>\n    {\n        const loginButtons = [].slice.call(document.querySelectorAll(\".plg_system_passwordless_login_button\"));\n        if (loginButtons.length)\n        {\n            loginButtons.forEach((button) =>\n            {\n                button.addEventListener(\"click\", (e) =>\n                {\n                    e.preventDefault();\n\n                    const currentTarget = e.currentTarget;\n\n                    Passwordless.login(\n                        currentTarget,\n                        currentTarget.getAttribute(\"data-passwordless-url\")\n                    );\n                });\n            });\n        }\n    }\n\n    // Initialization. Runs on DOM content loaded since this script is always loaded deferred.\n    Passwordless.initManagement();\n    Passwordless.initLogin();\n\n})(Joomla, window.akeeba.Passwordless, document);\n"],"file":"passwordless.js"}